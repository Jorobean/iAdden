<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Camera</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            background: #000;
            position: fixed;
        }

        .video-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #cameraVideo {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
        }

        .pip-button {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.5);
            border: none;
            padding: 12px 20px;
            border-radius: 20px;
            color: white;
            font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            font-size: 14px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .pip-button:hover {
            background: rgba(0,0,0,0.7);
        }

        .pip-button svg {
            width: 20px;
            height: 20px;
            fill: white;
        }
    </style>
</head>
<body>
    <div class="video-container">
        <video id="cameraVideo" autoplay playsinline muted></video>
        <button class="pip-button" id="pipBtn">
            <svg viewBox="0 0 24 24">
                <path d="M19 7h-8v6h8V7zm2-4H3C2 3 1 4 1 5v14c0 1 1 2 2 2h18c1 0 2-1 2-2V5c0-1-1-2-2-2zm0 16H3V5h18v14z"/>
            </svg>
            Picture in Picture
        </button>
    </div>

    <script>
        const cameraVideo = document.getElementById('cameraVideo');
        const pipBtn = document.getElementById('pipBtn');
        let currentFacingMode = 'user';

        // Initialize camera
        async function initCamera() {
            try {
                const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
                
                const constraints = {
                    video: {
                        facingMode: currentFacingMode,
                        width: isIOS ? { min: 640, ideal: 1280, max: 1920 } : { ideal: 1920 },
                        height: isIOS ? { min: 480, ideal: 720, max: 1080 } : { ideal: 1080 }
                    },
                    audio: false
                };

                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                cameraVideo.srcObject = stream;

                // Hide PiP button if not supported
                if (!document.pictureInPictureEnabled) {
                    pipBtn.style.display = 'none';
                }
            } catch (err) {
                console.error('Error accessing camera:', err);
                alert('Unable to access camera. Please ensure you have granted camera permissions.');
            }
        }

        // PiP functionality
        pipBtn.addEventListener('click', async () => {
            try {
                if (document.pictureInPictureElement) {
                    await document.exitPictureInPicture();
                    pipBtn.innerHTML = `
                        <svg viewBox="0 0 24 24">
                            <path d="M19 7h-8v6h8V7zm2-4H3C2 3 1 4 1 5v14c0 1 1 2 2 2h18c1 0 2-1 2-2V5c0-1-1-2-2-2zm0 16H3V5h18v14z"/>
                        </svg>
                        Picture in Picture`;
                } else if (document.pictureInPictureEnabled) {
                    await cameraVideo.requestPictureInPicture();
                    pipBtn.innerHTML = `
                        <svg viewBox="0 0 24 24">
                            <path d="M19 11h-8v6h8v-6zm4 8V4.98C23 3.88 22.1 3 21 3H3c-1.1 0-2 .88-2 1.98V19c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2zm-2 .02H3V4.97h18v14.05z"/>
                        </svg>
                        Exit PiP`;
                }
            } catch (err) {
                console.error('PiP error:', err);
                alert('Picture-in-Picture mode failed. This feature may not be supported in your browser.');
            }
        });

        // Handle PiP mode changes
        cameraVideo.addEventListener('leavepictureinpicture', () => {
            pipBtn.innerHTML = `
                <svg viewBox="0 0 24 24">
                    <path d="M19 7h-8v6h8V7zm2-4H3C2 3 1 4 1 5v14c0 1 1 2 2 2h18c1 0 2-1 2-2V5c0-1-1-2-2-2zm0 16H3V5h18v14z"/>
                </svg>
                Picture in Picture`;
        });

        // Initialize on page load
        window.addEventListener('load', initCamera);

        // Handle iOS orientation changes
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                const viewportHeight = window.innerHeight;
                document.documentElement.style.height = `${viewportHeight}px`;
            }, 200);
        });

        // Prevent unwanted touch behaviors on iOS
        document.addEventListener('touchmove', (e) => e.preventDefault(), { passive: false });
    </script>
</body>
</html>